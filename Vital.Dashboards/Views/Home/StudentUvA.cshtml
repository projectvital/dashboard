@{
    ViewBag.Title = "Student";
    ViewBag.HideTitle = true;
    ViewBag.RequireD3 = true;
}

<style>
    
    #_ProgressInWeek_container {
        margin-bottom: 15px;
        width: 160px;
        height: 70px;
        /*width: 250px;
        height: 115px;*/
    }
    /*#_ProgressInWeek_label {
        font-weight: bold;
        text-align: center;
        font-size: 0.9em;
        max-width: 150px;
    }*/
    
    #body-container {
        background-color: transparent;
    }


    /*.counter-outer-circle {
        width: 250px;
        height: 250px;
        text-align: center;
        background-color: lightgray;
        -moz-border-radius: 125px;
        -webkit-border-radius: 125px;
        border-radius: 125px;
        padding-top: 50px;
        margin: 0 auto;
        margin-top: 20px;
        margin-bottom: 20px;
    }
    .counter-inner-circle {
        width: 150px;
        height: 150px;
        background-color: gray;
        -moz-border-radius: 75px;
        -webkit-border-radius: 75px;
        border-radius: 75px;
        margin: 0 auto;
        color: white;
        font-size: 3em;
        padding-top: 45px;
    }*/
    .counter-circle {
        width: 130px;
        height: 130px;
        border: 20px solid gray;
        -moz-border-radius: 65px;
        -webkit-border-radius: 65px;
        border-radius: 65px;
        margin: 0 auto;
        color: white;
        font-size: 30px;
        font-weight: bold;
        padding-top: 25px;
    }

    /*.col-md-4.counter, .col-md-6.counter*/
    .col-xs-1, .col-xs-2, .col-xs-3, .col-xs-4, .col-xs-5, .col-xs-6, .col-xs-7, .col-xs-8, .col-xs-9, .col-xs-10, .col-xs-11, .col-xs-12, .col-sm-1, .col-sm-2, .col-sm-3, .col-sm-4, .col-sm-5, .col-sm-6, .col-sm-7, .col-sm-8, .col-sm-9, .col-sm-10, .col-sm-11, .col-sm-12, .col-md-1, .col-md-2, .col-md-3, .col-md-4, .col-md-5, .col-md-6, .col-md-7, .col-md-8, .col-md-9, .col-md-10, .col-md-11, .col-md-12, .col-lg-1, .col-lg-2, .col-lg-3, .col-lg-4, .col-lg-5, .col-lg-6, .col-lg-7, .col-lg-8, .col-lg-9, .col-lg-10, .col-lg-11, .col-lg-12 {
        padding-bottom: 10px;
        padding-left:  8px;
        padding-right: 8px;
    }
    @@media (min-width:500px) {
            .col-md-2.counter {
                width: 50%;
                float: left;
            }
    }
     @@media (min-width:750px) {
            .col-md-2.counter {
                width: 33%;
                float: left;
            }
    }
    @@media (min-width: 992px) {
            .col-md-2.counter {
                width: 20%;
            }
    }
</style>

<div class="mainbox">
    <div class="region-top">
        <div class="container">
@*            <div class="row">
                <div class="col-md-3" style="padding: 0;">
                </div>
                <div class="col-md-6" style="color: lightgray;">
                </div>
                <div class="col-md-3" style="padding: 0;">
                    <img src="/Content/Images/logo-vital.png" alt="Vital" />
                </div>
            </div>*@
           
            <div class="row" style="padding-bottom: 0px;">
                <div class="col-md-2 counter" style="">
                    <div class="block-container counter">
                        <div class="info infotooltip" data-tooltip-content="#tooltip_counter_generic">i</div>
                        <h2 id="_CompletedExercises_container_name">...</h2>
                        <div class="counter-circle" id="_CompletedExercises_container_value" style="background-color: #386cb0; border-color: lightblue;"></div>
                    </div>
                </div>
                <div class="col-md-2 counter" style="">
                    <div class="block-container counter">
                        <div class="info infotooltip" data-tooltip-content="#tooltip_counter_generic">i</div>
                        <h2 id="_CompletedExercisesScore_container_name">...</h2>
                        <div class="counter-circle" id="_CompletedExercisesScore_container_value" style="background-color: #fdc086; border-color: #ffe4cc;"></div>
                    </div>
                </div>
                <div class="col-md-2 counter" style="">
                    <div class="block-container counter">
                        <div class="info infotooltip" data-tooltip-content="#tooltip_counter_generic">i</div>
                        <h2 id="_ProgressInWeek_label">...</h2>
                        <div class="count-widget" id="_ProgressInWeek_container" style="/*background-color: #9467bd;*/"></div>
                    </div>
                </div>
                <div class="col-md-2 counter" style="">
                    <div class="block-container counter">
                        <div class="info infotooltip" data-tooltip-content="#tooltip_counter_generic">i</div>
                        <h2 id="_CompletedAssessments_container_name">...</h2>
                        <div class="counter-circle" id="_CompletedAssessments_container_value" style="background-color: #BF5B17; border-color: #daa17a;"></div>
                    </div>
                </div>
                <div class="col-md-2 counter" style="">
                    <div class="block-container counter">
                        <div class="info infotooltip" data-tooltip-content="#tooltip_counter_generic">i</div>
                        <h2 id="_CompletedAssessmentsScore_container_name">...</h2>
                        <div class="counter-circle" id="_CompletedAssessmentsScore_container_value" style="background-color: #E73959; border-color: #ffc1c2;"></div>
                    </div>
                </div>
            </div>
            @*<div class="row" style="padding-bottom: 10px; padding-top: 30px;">
                <div class="block-container" style="padding-top: 10px;padding-bottom: 10px;">
                    <div class="count-container">
                        <div class="info counter infotooltip" data-tooltip-content="#tooltip_counter_completed_exercise">i</div>
                        <div class="count-widget" id="_CompletedExercises_container_old" style="background-color: #1f77b4;"></div>
                    </div>
                    <div class="count-container">
                        <div class="info counter infotooltip" data-tooltip-content="#tooltip_counter_completed_exercise">i</div>
                        <div class="count-widget" id="_CompletedExercisesScore70_container_old" style="background-color: #ff7f0e;"></div>
                    </div>
                    <div class="count-container">
                        <!--<div class="info counter infotooltip" data-tooltip-content="#tooltip_counter_perc_activities_completed">i</div>
                        <div class="count-widget" id="_ProgressInWeek_container" style="/*background-color: #9467bd;*/"></div>
                        <div id="_ProgressInWeek_label" style="/*background-color: #9467bd;*/"></div>-->
                    </div>
                    <div class="count-container">
                        <div class="info counter infotooltip" data-tooltip-content="#tooltip_counter_audio">i</div>
                        <div class="count-widget" id="_PlayedAudio_container_old" style="background-color: #2ca02c;"></div>
                    </div>
                    <div class="count-container">
                        <div class="info counter infotooltip" data-tooltip-content="#tooltip_counter_audio">i</div>
                        <div class="count-widget" id="_RecordedVoice_container_old" style="background-color: #d62728;"></div>
                    </div>
                </div>
            </div>*@
            <div class="row" style="text-align: center;">
                <div class="col-md-6" style="/*padding: 0; /*border-right: 2px solid black; */min-height: 475px;">
                    <div class="block-container">
                        <div class="info infotooltip" data-tooltip-content="#tooltip_graph_activity_timing">i</div>
                        <h2>Activity timing</h2>
                        @Html.Partial("~/Views/Dashboards/ActivityByTypeByDay.cshtml", new Dictionary<string, string>(){ { "width", "530" }, { "height", "350"} })
                        @*@Html.Partial("~/Views/Dashboards/ActivityByChapter.cshtml", new Dictionary<string, string>(){ { "width", "500" }, { "height", "350"} })*@
                    </div>
                </div>
                <div class="col-md-6" style="">
                    <div class="block-container">
                        <div class="info infotooltip" data-tooltip-content="#tooltip_graph_course_schedule">i</div>
                        <h2>Course schedule & progress</h2>
                        @Html.Partial("~/Views/Dashboards/ProgressStatusHorizontal.cshtml", new Dictionary<string, string>(){ { "width", "500" }, { "height", "350"} })
                    </div>
                </div>
            </div>
			<div class="row" style="text-align: center;">
                <div class="col-md-12" style="">
                    <div class="block-container">
                        <div class="info infotooltip" data-tooltip-content="#tooltip_graph_activity_by_chapter">i</div>
                        <h2>Activity by chapter</h2>
                        
                        <select id="x_verbSelect" style="float: left; margin-left: 15px;"></select>
                        @Html.Partial("~/Views/Dashboards/ActivityByChapter.cshtml", new Dictionary<string, string>(){ { "width", "1000" }, { "height", "350"} })
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@Html.Partial("~/Views/Shared/_PartialPage_Tooltips_UvA.cshtml")

<script src="~/Scripts/progressbar.min.js"></script>
<script>
    GlobalRebuildFunctions.push(buildCounts_@(ViewBag.Key));
   
    function buildCounts_@(ViewBag.Key)() {
        var parameters = {};
        parameters["courseinstanceid"] = GetSelectedCourseInstance();//"@(ViewBag.CourseInstanceId)";
        AddDataFilterFromCombo("#x_studentSelect", "logagentid", parameters);
        AddDataFilterFromCombo("#x_programmeSelect", "programmeid", parameters);

        @*GetData('@ViewBag.ApiUrl/v1/Data/Count/CompletedExercises/Average', function (error, data) { 
            FillVisualControlWithCountModel("_CompletedExercises_container_old", error, data, function (container, data) { container.innerHTML = "<div><div class=\"count-widget-counter\">" + data.Count + "</div><div class=\"count-widget-name\">" + data.Name + "</div></div>"; });
        }, parameters);
        
        GetData('@ViewBag.ApiUrl/v1/Data/Count/CompletedExercises/Average/70', function (error, data) {
            FillVisualControlWithCountModel("_CompletedExercisesScore70_container_old", error, data, function (container, data) { container.innerHTML = "<div class=\"\"><div class=\"count-widget-counter\">" + data.Count + "</div><div class=\"count-widget-name\">" + data.Name + "</div></div>"; });
        }, parameters);

        GetData('@ViewBag.ApiUrl/v1/Data/Count/PlayedAudio/Average', function (error, data) { 
            FillVisualControlWithCountModel("_PlayedAudio_container_old", error, data, function (container, data) { container.innerHTML = "<div class=\"\"><div class=\"count-widget-counter\">" + data.Count + "</div><div class=\"count-widget-name\">" + data.Name + "</div></div>"; });
        }, parameters);

        GetData('@ViewBag.ApiUrl/v1/Data/Count/RecordedVoice/Average', function (error, data) {
            FillVisualControlWithCountModel("_RecordedVoice_container_old", error, data, function (container, data) { container.innerHTML = "<div class=\"\"><div class=\"count-widget-counter\">" + data.Count + "</div><div class=\"count-widget-name\">" + data.Name + "</div></div>"; });
        }, parameters);*@

   

        
        GetData('@ViewBag.ApiUrl/v1/Data/Count/CompletedExercises/Average', function (error, data) { 
            FillBigVisualControlWithCountModel("_CompletedExercises_container_value", "_CompletedExercises_container_name", error, data);
        }, parameters);
        
        GetData('@ViewBag.ApiUrl/v1/Data/Count/CompletedExercises/Average/50', function (error, data) {
            FillBigVisualControlWithCountModel("_CompletedExercisesScore_container_value", "_CompletedExercisesScore_container_name", error, data);
        }, parameters);

        GetData('@ViewBag.ApiUrl/v1/Data/Count/CompletedAssessments/Average', function (error, data) {
            FillBigVisualControlWithCountModel("_CompletedAssessments_container_value", "_CompletedAssessments_container_name", error, data);
        }, parameters);
        
        GetData('@ViewBag.ApiUrl/v1/Data/Count/CompletedAssessments/Average/75', function (error, data) {
            FillBigVisualControlWithCountModel("_CompletedAssessmentsScore_container_value", "_CompletedAssessmentsScore_container_name", error, data);
        }, parameters);

        drawProgressBarForWeek();

        @*GetData('@ViewBag.ApiUrl/v1/Data/Count/CompletedExercises/70', function (error, data) { FillControlWithCountModel("_CompletedExercisesScore70_container_@(ViewBag.Key)", error, data); }, parameters);
        GetData('@ViewBag.ApiUrl/v1/Data/Count/PlayedAudio', function (error, data) { FillControlWithCountModel("_PlayedAudio_container_@(ViewBag.Key)", error, data); }, parameters);
        *@
    }
    function drawProgressBarForWeek()
    {
        var jsonData = {};
        jsonData["timeblock"] = "current";
        jsonData["courseinstanceid"] = GetSelectedCourseInstance();
        AddDataFilterFromCombo("#x_studentSelect", "logagentid", jsonData);
        AddDataFilterFromCombo("#x_programmeSelect", "programmeid", jsonData);

        GetCsvChartData("@ViewBag.ApiUrl/v1/ChartData/ProgressStatus", drawProgressBarForWeekType, drawProgressBarForWeekCallback, jsonData/*"a=2&b=3"*/);
    }
    function drawProgressBarForWeekType(d, i, columns) {
        for (var i = 1, n = columns.length; i < n; ++i) d[columns[i]] = +d[columns[i]];
        return d;
    }
    function drawProgressBarForWeekCallback(error, data)
    {
        _ProgressInWeek_container.innerHTML = "";
        _ProgressInWeek_label.innerHTML = "";

        //Returned results in format: timeblock,total,groupcount,count,average
        //For 1 student: take actual value (=count).
        //For all students: take average value.
        var value = 0;
        var label = "";
        if(data)
        {
            var studentFilter = GetDataFilterFromCombo("#x_studentSelect");
            if(!studentFilter) studentFilter = -1;

            if(data.length == 1)
            {
                if(studentFilter == -1)
                    value = +data[0].average / +data[0].total;
                else
                    value = +data[0].count / +data[0].total;

                _ProgressInWeek_label.innerHTML = 'Activities of week ' + +data[0].timeblock + ' completed';
            }
            else if (data.length > 1)
            {
                var grand_total = d3.sum(data, function (d) { return +d.total; });

                if(studentFilter == -1)
                {
                    value = d3.sum(data, function (d) { return +d.average; }) / grand_total;
                    _ProgressInWeek_label.innerHTML = 'Activities completed on average (entire course)';
                }
                else
                {
                    value = d3.sum(data, function (d) { return +d.count; }) / grand_total;
                    _ProgressInWeek_label.innerHTML = 'Activities completed (entire course)';
                }
                
                
            }
        }

        

        var bar = new ProgressBar.SemiCircle(_ProgressInWeek_container, {
            strokeWidth: 20,
            color: '#9467bd',
            trailColor: '#eee',
            trailWidth: 15,
            easing: 'easeInOut',
            duration: 1400,
            svgStyle: null,
            text: {
                value: '',
                alignToBottom: false
            },
            from: {color: '#d62728'},
            to: {color: '#61cc04'},
            // Set default step function for all animate calls
            step: (state, bar) => {
                bar.path.setAttribute('stroke', state.color);
                var value = Math.round(bar.value() * 100);
                if (value === 0) {
                    bar.setText('');
                } else {
                    bar.setText(value + '%');
                }

                bar.text.style.color = state.color;
            }
        });
        bar.text.style.fontFamily = '"Raleway", Helvetica, sans-serif';
        bar.text.style.fontSize = '3rem';
        

        bar.animate(value);  //
    
    }
</script>

